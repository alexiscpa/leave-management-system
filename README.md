# 部門請假管理系統

一個簡潔易用的請假管理系統，專注於讓團隊成員互相了解彼此的請假時段，並自動管理代理人衝突。

## 系統特色

- **即時生效**：員工提交請假後立即核准，無需等待審核
- **公開透明**：所有已核准的請假都會在週曆上公開顯示
- **衝突管理**：自動檢測代理人衝突，需要時才要求主管核准
- **簡潔介面**：清楚的週曆視圖，一目了然

---

## 核心邏輯

### 1. 請假流程

#### 一般情況（無衝突）
```
員工提交請假 → 系統檢查代理人 → 沒有衝突 → 立即核准 → 週曆顯示
```

#### 代理人衝突情況
```
員工提交請假 → 系統檢查代理人 → 代理人同時段也請假 → 需主管核准 → 核准後才在週曆顯示
```

### 2. 代理人衝突定義

當以下情況發生時，視為代理人衝突：
- 員工A的代理人是員工B
- 員工A申請某時段請假
- 員工B在**相同時段**也有請假（已核准或待審核）
- 此時員工A的請假需要主管特別核准

### 3. 週曆顯示規則

- **只顯示已核准的請假**
- 待主管核准的請假不會顯示
- 主管核准後才會出現在週曆上
- 不顯示代理人資訊（只顯示實際請假的員工）

---

## 主要功能

### 1. 週曆視圖
- 以週為單位顯示所有員工的請假狀態
- 橫軸：週一到週五（工作日）
- 縱軸：工作時段（08:30-17:30，每小時一格）
- 支援切換年、月、週

### 2. 請假申請
- 選擇日期、時間、填寫原因
- 系統自動計算請假時數
- 自動檢測代理人衝突
- 無衝突時立即核准

### 3. 主管核准
- 只有當代理人有衝突時才需要主管介入
- 主管可以核准或拒絕申請
- 拒絕時需要填寫原因

### 4. 人員設定
- 管理員工基本資料
- 設定每位員工的第一代理人
- 支援編輯員工姓名和代理人

---

## 使用方法

### 開啟系統
1. 在瀏覽器中打開 `index.html`
2. 系統會自動初始化 10 位預設員工（員工A-J）

### 切換身分
- 右上角選擇「登入身分」：
  - **一般員工**：可以查看週曆、提交請假
  - **主管**：可以核准有衝突的請假申請
- 選擇當前用戶（員工A-J）

### 提交請假
1. 切換到「請假申請」分頁
2. 選擇請假日期
3. 選擇開始時間和結束時間
4. 填寫請假原因
5. 點擊「提交申請」

**系統反應：**
- 無衝突：顯示「請假申請已核准！您的請假資訊已公開給所有人查看」
- 有衝突：顯示「您的代理人 XXX 在此時段也有請假，需要主管特別核准」

### 主管核准流程
1. 切換身分為「主管」
2. 切換到「主管核准」分頁
3. 查看需要核准的請假申請
4. 點擊「核准」或「拒絕」

### 查看請假狀態
1. 切換到「週曆視圖」
2. 選擇年月週
3. 查看所有已核准的請假

---

## 測試情境

### 情境 1：單一員工請假
```
步驟：
1. 選擇「員工A」
2. 在 2025/12/30 申請上午請假（08:30-12:30）
3. 點擊提交

預期結果：
- 提示「請假申請已核准」
- 週曆立即顯示「員工A 請假」
```

### 情境 2：多位員工請假（無衝突）
```
步驟：
1. 員工A 在 12/30 上午請假
2. 員工C 在 12/30 下午請假

預期結果：
- 兩位員工都立即核准
- 週曆同時顯示兩位員工的請假
```

### 情境 3：代理人衝突
```
步驟：
1. 員工A（代理人是員工B）在 12/30 上午請假 → 立即核准
2. 員工B 在 12/30 上午也要請假 → 系統偵測到衝突

預期結果：
- 系統提示「您的代理人 員工A 在此時段也有請假」
- 員工B 的請假狀態為「待審」
- 週曆只顯示員工A，不顯示員工B
- 主管核准後，週曆才會同時顯示員工A和員工B
```

---

## 系統架構

### 文件結構
```
leave management system/
├── index.html          # 主頁面（UI結構）
├── app.js              # 核心業務邏輯
├── styles.css          # 視覺樣式
└── README.md           # 本文件
```

### 資料結構

#### 員工資料
```javascript
{
    id: 'A',              // 員工ID
    name: '員工A',        // 員工姓名
    proxyId: 'B'          // 第一代理人ID
}
```

#### 請假記錄
```javascript
{
    id: '1234567890',           // 記錄唯一ID
    employeeId: 'A',            // 申請人ID
    employeeName: '員工A',      // 申請人姓名
    date: '2025-12-30',         // 請假日期（YYYY-MM-DD）
    startTime: '08:30',         // 開始時間
    endTime: '12:30',           // 結束時間
    reason: '私人事務',         // 請假原因
    status: 'approved',         // 狀態：approved/pending/rejected
    needsSpecialApproval: false, // 是否需要主管特別核准
    appliedAt: '2025-12-29T...',// 申請時間戳
    rejectReason: ''            // 拒絕原因（若有）
}
```

### 資料儲存
- 使用瀏覽器的 **localStorage** 儲存資料
- 資料會保留在本機，瀏覽器重新整理後仍然存在
- 清除資料：開啟開發者工具 → Console → 輸入 `localStorage.clear()`

---

## 技術說明

### 工作時段設定
- 工作時間：08:30 - 17:30（共 9 小時）
- 時段劃分：每小時一個時段
- 時間選項：08:30, 09:30, 10:30, 11:30, 12:30, 13:30, 14:30, 15:30, 16:30, 17:30

### 核心函數

#### `checkProxyConflict(employeeId, date, startTime, endTime)`
檢查員工的代理人是否在同一時段有請假
- 回傳值：衝突記錄陣列（空陣列表示無衝突）

#### `getLeavesByDateAndTime(date, time)`
取得特定日期和時段的所有已核准請假
- 只回傳 status === 'approved' 的記錄

#### `handleLeaveSubmit(e)`
處理請假申請提交
- 檢查代理人衝突
- 無衝突：status = 'approved'
- 有衝突：status = 'pending', needsSpecialApproval = true

---

## 常見問題

### Q1: 如何清除測試資料？
**A:** 在瀏覽器按 F12 打開開發者工具 → Console 分頁 → 輸入以下指令：
```javascript
localStorage.clear()
```
然後重新整理頁面。

### Q2: 為什麼週曆上看不到我的請假？
**A:** 可能的原因：
1. 請假狀態是「待審」，需要主管核准後才會顯示
2. 選擇的週別不正確，請確認年月週選擇器

### Q3: 什麼時候需要主管核准？
**A:** 只有當您的代理人在同一時段也有請假（已核准或待審）時，才需要主管核准。

### Q4: 可以取消已提交的請假嗎？
**A:** 目前系統尚未實作取消功能。如需修改，請聯繫主管或系統管理員。

### Q5: 代理人資訊在哪裡看？
**A:** 切換到「人員設定」分頁，可以看到每位員工的第一代理人。

---

## 系統限制

1. **單一代理人**：每位員工只能設定一位第一代理人
2. **本機儲存**：資料儲存在瀏覽器，不支援多裝置同步
3. **無歷史記錄**：無法查看歷史請假記錄
4. **無通知功能**：不會發送郵件或推播通知

---

## 未來規劃

以下功能可能在未來版本中實作：
- [ ] 請假取消功能
- [ ] 請假歷史記錄查詢
- [ ] 統計報表（請假天數、時數等）
- [ ] 匯出功能（Excel, PDF）
- [ ] 第二代理人設定
- [ ] 郵件通知
- [ ] 後端資料庫整合

---

## 版本資訊

**版本**：1.0.0
**更新日期**：2025-12-29
**開發者**：Claude Code

### 更新記錄

#### v1.0.0 (2025-12-29)
- 初始版本發布
- 實作核心請假流程
- 實作代理人衝突檢測
- 實作週曆視圖
- 實作主管核准機制

---

## 技術支援

如有問題或建議，歡迎聯繫系統管理員。

---

## 授權

本系統僅供內部使用。
